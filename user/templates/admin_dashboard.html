{% extends 'layout.html' %}

{% block body %}
<style>
    /* Admin Dashboard Styles */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    .admin-dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        color: white;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .admin-header {
        background: linear-gradient(135deg, 
            rgba(0, 0, 0, 0.9) 0%, 
            rgba(220, 53, 69, 0.3) 50%, 
            rgba(0, 0, 0, 0.9) 100%);
        border-left: 6px solid #dc3545;
        border-right: 6px solid #dc3545;
        text-align: center;
        padding: 50px 30px;
        margin-bottom: 40px;
        border-radius: 20px;
        position: relative;
        overflow: hidden;
    }
     .admin-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(220,53,69,0.1)"/></svg>');
        background-size: cover;
    }
    .admin-header h1 {
        font-size: 3em;
        background: linear-gradient(135deg, #dc3545, #ffc107);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 15px;
        font-weight: 800;
        position: relative;
    }
    
       .admin-actions-bar {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }
    .admin-header p {
        font-size: 1.3em;
        opacity: 0.9;
        margin-bottom: 20px;
    }
    
    .admin-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
    }
    
    .admin-stat-card {
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(0, 0, 0, 0.2));
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
    }
    
    .admin-stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #4CAF50, #2196F3, #FF9800, #9C27B0);
    }
    
    .admin-stat-card:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        border-color: rgba(76, 175, 80, 0.5);
    }
    
    .stat-icon {
        font-size: 3em;
        margin-bottom: 20px;
        display: inline-block;
        width: 80px;
        height: 80px;
        line-height: 80px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
    }
    
    .stat-icon.users { color: #2196F3; }
    .stat-icon.uploads { color: #4CAF50; }
    .stat-icon.queries { color: #FF9800; }
    .stat-icon.pests { color: #9C27B0; }
    .stat-icon.today-uploads { color: #00BCD4; }
    .stat-icon.today-queries { color: #E91E63; }
    
    .stat-number {
        font-size: 3.2em;
        font-weight: bold;
        margin: 15px 0;
        color: white;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }
    
    .stat-label {
        font-size: 1.2em;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 500;
    }
    
    .stat-trend {
        font-size: 0.9em;
        margin-top: 10px;
        padding: 5px 10px;
        border-radius: 15px;
        display: inline-block;
    }
    
    .trend-up { background: rgba(76, 175, 80, 0.2); color: #4CAF50; }
    .trend-down { background: rgba(244, 67, 54, 0.2); color: #f44336; }
    
    /* Charts Section */
    .charts-section {
        margin-bottom: 40px;
    }
    
    .charts-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
        margin-top: 20px;
    }
    
    @media (max-width: 992px) {
        .charts-container {
            grid-template-columns: 1fr;
        }
    }
    
    .chart-card {
        background: rgba(255, 255, 255, 0.05);
        padding: 25px;
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .chart-header h3 {
        color: #4CAF50;
        font-size: 1.3em;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .chart-container {
        height: 300px;
        position: relative;
        width: 100%;
    }
    
    .admin-sections {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
        gap: 30px;
        margin-bottom: 40px;
    }
    
    @media (max-width: 768px) {
        .admin-sections {
            grid-template-columns: 1fr;
        }
    }
    
    .admin-section {
        background: rgba(255, 255, 255, 0.08);
        padding: 30px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .section-header h2 {
        color: #4CAF50;
        font-size: 1.6em;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .view-all-btn {
        background: linear-gradient(135deg, #2196F3, #1976D2);
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        font-size: 0.95em;
        font-weight: 500;
        transition: all 0.3s;
        border: none;
        cursor: pointer;
    }
    
    .view-all-btn:hover {
        background: linear-gradient(135deg, #1976D2, #0D47A1);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
    }
    
    .admin-table-container {
        overflow-x: auto;
        border-radius: 10px;
        background: rgba(0, 0, 0, 0.2);
        padding: 1px;
    }
    
    .admin-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 600px;
    }
    
    .admin-table th {
        background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(76, 175, 80, 0.2));
        padding: 18px;
        text-align: left;
        color: #4CAF50;
        font-weight: 600;
        font-size: 1.1em;
        border-bottom: 3px solid rgba(255, 255, 255, 0.1);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .admin-table td {
        padding: 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        vertical-align: middle;
    }
    
    .admin-table tr {
        transition: background 0.3s;
    }
    
    .admin-table tr:hover {
        background: rgba(255, 255, 255, 0.08);
    }
    
    .user-avatar {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, #2196F3, #00BCD4);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1.2em;
        margin-right: 15px;
        box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
    }
    
    .user-info {
        display: flex;
        align-items: center;
    }
    
    .user-details {
        display: flex;
        flex-direction: column;
    }
    
    .user-name {
        font-weight: 600;
        color: white;
    }
    
    .user-email {
        font-size: 0.85em;
        opacity: 0.7;
        margin-top: 2px;
    }
    
    .status-badge {
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: 600;
        display: inline-block;
        min-width: 100px;
        text-align: center;
    }
    
    .status-active {
        background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.1));
        color: #4CAF50;
        border: 1px solid rgba(76, 175, 80, 0.3);
    }
    
    .status-pending {
        background: linear-gradient(135deg, rgba(255, 152, 0, 0.2), rgba(255, 152, 0, 0.1));
        color: #FF9800;
        border: 1px solid rgba(255, 152, 0, 0.3);
    }
    
    .status-processing {
        background: linear-gradient(135deg, rgba(33, 150, 243, 0.2), rgba(33, 150, 243, 0.1));
        color: #2196F3;
        border: 1px solid rgba(33, 150, 243, 0.3);
    }
    
    .status-resolved {
        background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.1));
        color: #4CAF50;
        border: 1px solid rgba(76, 175, 80, 0.3);
    }
    
    .action-buttons {
        display: flex;
        gap: 8px;
    }
    
    .btn-small {
        padding: 8px 16px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-size: 0.9em;
        font-weight: 500;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
        min-width: 40px;
        justify-content: center;
    }
    
    .btn-view {
        background: linear-gradient(135deg, #2196F3, #1976D2);
        color: white;
    }
    
    .btn-edit {
        background: linear-gradient(135deg, #4CAF50, #388E3C);
        color: white;
    }
    
    .btn-delete {
        background: linear-gradient(135deg, #f44336, #d32f2f);
        color: white;
    }
    
    .btn-small:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .btn-view:hover {
        background: linear-gradient(135deg, #1976D2, #0D47A1);
    }
    
    .btn-edit:hover {
        background: linear-gradient(135deg, #388E3C, #2E7D32);
    }
    
    .btn-delete:hover {
        background: linear-gradient(135deg, #d32f2f, #c2185b);
    }
    
    .admin-quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
    }
    
    .quick-action-card {
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(0, 0, 0, 0.2));
        padding: 35px;
        border-radius: 15px;
        text-align: center;
        text-decoration: none;
        color: white;
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    
    .quick-action-card:hover {
        transform: translateY(-10px) scale(1.05);
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.15), rgba(0, 0, 0, 0.25));
        border-color: #4CAF50;
        box-shadow: 0 20px 40px rgba(76, 175, 80, 0.3);
    }
    
    .action-icon {
        font-size: 3.5em;
        margin-bottom: 25px;
        color: #4CAF50;
        width: 90px;
        height: 90px;
        line-height: 90px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    
    .quick-action-card h3 {
        margin-bottom: 15px;
        font-size: 1.4em;
        color: white;
    }
    
    .quick-action-card p {
        opacity: 0.8;
        font-size: 1em;
        line-height: 1.5;
    }
    
    .language-selector {
        background: rgba(255, 255, 255, 0.08);
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 30px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .language-buttons {
        display: flex;
        gap: 15px;
        margin-top: 15px;
        flex-wrap: wrap;
    }
    
    .lang-btn {
        padding: 12px 25px;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        text-decoration: none;
        color: white;
        font-weight: 600;
        transition: all 0.3s;
        min-width: 120px;
        text-align: center;
    }
    
    .lang-btn:hover {
        background: rgba(76, 175, 80, 0.3);
        border-color: #4CAF50;
        transform: translateY(-3px);
    }
    
    .lang-btn.active {
        background: linear-gradient(135deg, #4CAF50, #388E3C);
        border-color: #4CAF50;
        box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
    }
    
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: rgba(255, 255, 255, 0.7);
    }
    
    .empty-icon {
        font-size: 4em;
        margin-bottom: 25px;
        opacity: 0.5;
    }
    
    .empty-state h3 {
        font-size: 1.8em;
        margin-bottom: 15px;
        color: rgba(255, 255, 255, 0.9);
    }
    
    .empty-state p {
        font-size: 1.1em;
        max-width: 500px;
        margin: 0 auto 25px;
        line-height: 1.6;
    }
    
    .message-preview {
        max-width: 200px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: inline-block;
    }
    
    .system-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-top: 20px;
    }
    
    .info-card {
        background: rgba(255, 255, 255, 0.05);
        padding: 25px;
        border-radius: 12px;
        border-left: 4px solid #4CAF50;
    }
    
    .info-card h4 {
        color: #4CAF50;
        margin-bottom: 15px;
        font-size: 1.2em;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .info-card p {
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    /* Animation for stats */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .admin-stat-card, .admin-section, .quick-action-card {
        animation: fadeInUp 0.6s ease-out forwards;
    }
    
    .admin-stat-card:nth-child(1) { animation-delay: 0.1s; }
    .admin-stat-card:nth-child(2) { animation-delay: 0.2s; }
    .admin-stat-card:nth-child(3) { animation-delay: 0.3s; }
    .admin-stat-card:nth-child(4) { animation-delay: 0.4s; }
    .admin-stat-card:nth-child(5) { animation-delay: 0.5s; }
    .admin-stat-card:nth-child(6) { animation-delay: 0.6s; }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .admin-stats-grid {
            grid-template-columns: 1fr;
        }
        
        .admin-quick-actions {
            grid-template-columns: 1fr;
        }
        
        .admin-sections {
            grid-template-columns: 1fr;
        }
        
        .system-info-grid {
            grid-template-columns: 1fr;
        }
        
        .language-buttons {
            flex-direction: column;
        }
        
        .lang-btn {
            width: 100%;
        }
        
        .admin-header {
            padding: 25px 15px;
        }
        
        .admin-header h1 {
            font-size: 2em;
        }
        
        .admin-table {
            font-size: 0.9em;
        }
        
        .admin-table th,
        .admin-table td {
            padding: 12px 8px;
        }
    }
</style>

<div class="admin-dashboard-container">
    <!-- Admin Header -->
    <div class="admin-header">
        <h1>üëë Admin Dashboard</h1>
        <p>Welcome back, Administrator! Manage your pest detection system efficiently.</p>
        
        <!-- Language Selector
        <div class="language-selector">
            <h3 style="color: #4CAF50; margin-bottom: 15px;">üåê Select Language</h3>
            <div class="language-buttons">
                <a href="{{ url_for('change_language', lang='english', referrer=request.path) }}" 
                   class="lang-btn {% if current_lang == 'english' %}active{% endif %}">
                    English
                </a>
                <a href="{{ url_for('change_language', lang='bengali', referrer=request.path) }}" 
                   class="lang-btn {% if current_lang == 'bangla' %}active{% endif %}">
                    ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)
                </a>
                <a href="{{ url_for('change_language', lang='hindi', referrer=request.path) }}" 
                   class="lang-btn {% if current_lang == 'hindi' %}active{% endif %}">
                    ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)
                </a>
            </div>
        </div> -->
    </div>
    
    <!-- Stats Overview -->
    <div class="admin-stats-grid">
        <div class="admin-stat-card">
            <div class="stat-icon users">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-number">{{ total_users }}</div>
            <div class="stat-label">Total Users</div>
            <div class="stat-trend trend-up">Active</div>
        </div>
        
        <div class="admin-stat-card">
            <div class="stat-icon uploads">
                <i class="fas fa-upload"></i>
            </div>
            <div class="stat-number">{{ total_uploads }}</div>
            <div class="stat-label">Total Uploads</div>
            <div class="stat-trend trend-up">Processing</div>
        </div>
        
        <div class="admin-stat-card">
            <div class="stat-icon queries">
                <i class="fas fa-question-circle"></i>
            </div>
            <div class="stat-number">{{ total_queries }}</div>
            <div class="stat-label">User Queries</div>
            <div class="stat-trend trend-up">Active</div>
        </div>
        
        <div class="admin-stat-card">
            <div class="stat-icon pests">
                <i class="fas fa-bug"></i>
            </div>
            <div class="stat-number">{{ pest_count }}</div>
            <div class="stat-label">Pests in DB</div>
            <div class="stat-trend trend-up">Active</div>
        </div>
        
        <div class="admin-stat-card">
            <div class="stat-icon today-uploads">
                <i class="fas fa-calendar-day"></i>
            </div>
            <div class="stat-number">{{ today_uploads }}</div>
            <div class="stat-label">Today's Uploads</div>
            <div class="stat-trend trend-up">Live</div>
        </div>
        
        <div class="admin-stat-card">
            <div class="stat-icon today-queries">
                <i class="fas fa-comment-dots"></i>
            </div>
            <div class="stat-number">{{ today_queries }}</div> 
            <div class="stat-label">Today's Queries</div>
            <div class="stat-trend trend-up">Live</div>
        </div>
    </div>
    
    <!-- Charts Section -->
    <div class="charts-section">
        <div class="section-header">
            <h2><i class="fas fa-chart-line"></i> System Analytics</h2>
        </div>
        <div class="charts-container">
            <div class="chart-card">
                <div class="chart-header">
                    <h3><i class="fas fa-chart-line"></i> Activity Trend</h3>
                </div>
                <div class="chart-container">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <div class="chart-header">
                    <h3><i class="fas fa-chart-pie"></i> Pest Distribution</h3>
                </div>
                <div class="chart-container">
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="admin-quick-actions">
        <a href="{{ url_for('admin_queries') }}" class="quick-action-card">
            <div class="action-icon">
                <i class="fas fa-comments"></i>
            </div>
            <h3>Manage Queries</h3>
            <p>View and respond to user questions and feedback</p>
        </a>
        
        <a href="{{ url_for('admin_pest_management') }}" class="quick-action-card">
            <div class="action-icon">
                <i class="fas fa-bug"></i>
            </div>
            <h3>Pest Management</h3>
            <p>Manage pest database and control measures</p>
        </a>

           <a href="{{ url_for('admin_add_pest') }}" class="quick-action-card">
        <div class="action-icon" style="color: #FF9800;">
            <i class="fas fa-book-medical"></i>
        </div>
        <h3>Add to Pest Library</h3>
        <p>Add new pests with images and multilingual details</p>
    </a>
        
        <a href="{{ url_for('admin_user_management') }}" class="quick-action-card">
            <div class="action-icon">
                <i class="fas fa-user-cog"></i>
            </div>
            <h3>User Management</h3>
            <p>Manage user accounts and permissions</p>
        </a>
        
        <a href="{{ url_for('admin_analytics_page') }}" class="quick-action-card">
            <div class="action-icon">
                <i class="fas fa-chart-bar"></i>
            </div>
            <h3>System Analytics</h3>
            <p>View system performance and analytics</p>
        </a>
    </div>
    
    <!-- Recent Activity Sections -->
    <div class="admin-sections">
        <!-- Recent Uploads -->
        <!-- <div class="admin-section">
            <div class="section-header">
                <h2><i class="fas fa-images"></i> Recent Uploads</h2>
                <button class="view-all-btn" onclick="window.location.href='{{ url_for('admin_uploads') if 'admin_uploads' in url_map else '#' }}'">View All</button>
            </div>
            
            {% if recent_uploads %}
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Pest Detected</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for upload in recent_uploads %}
                        <tr>
                            <td>
                                <div class="user-info">
                                    <div class="user-avatar">
                                        {{ upload.username[0]|upper if upload.username else 'U' }}
                                    </div>
                                    <div class="user-details">
                                        <span class="user-name">{{ upload.username|default('Unknown') }}</span>
                                        <span class="user-email">{{ upload.email|default('No email') }}</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="status-badge status-active">{{ upload.pest_detected|default('Unknown') }}</span>
                            </td>
                            <td>{{ upload.formatted_date if upload.formatted_date else upload.uploaded_at.strftime('%d %b, %H:%M') if upload.uploaded_at else 'N/A' }}</td>
                            <td>
                                <span class="status-badge status-processing">{{ upload.status|default('Processed') }}</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-small btn-view" onclick="viewUpload('{{ upload._id }}')" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-small btn-delete" onclick="deleteUpload('{{ upload._id }}')" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h3>No Uploads Yet</h3>
                <p>Users haven't uploaded any images yet.</p>
            </div>
            {% endif %}
        </div>
        
        Recent Queries -->
        <!-- <div class="admin-section">
            <div class="section-header">
                <h2><i class="fas fa-question-circle"></i> Recent Queries</h2>
                <a href="{{ url_for('admin_queries') }}" class="view-all-btn">View All</a>
            </div>
            
            {% if recent_queries %}
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Message</th>
                            <th>Time</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for query in recent_queries %}
                        <tr>
                            <td><strong>{{ query.name|default('Anonymous') }}</strong></td>
                            <td>{{ query.email|default('No email') }}</td>
                            <td>
                                <span class="message-preview" title="{{ query.message|default('No message') }}">
                                    {{ (query.message|default('No message'))[:40] }}...
                                </span>
                            </td>
                            <td>{{ query.formatted_date if query.formatted_date else (query.timestamp.strftime('%H:%M') if query.timestamp else 'N/A') }}</td>
                            <td>
                                {% if query.status == 'resolved' %}
                                    <span class="status-badge status-resolved">Resolved</span>
                                {% elif query.status == 'in_progress' %}
                                    <span class="status-badge status-processing">In Progress</span>
                                {% else %}
                                    <span class="status-badge status-pending">Pending</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <h3>No Queries Yet</h3>
                <p>No user queries have been submitted yet.</p>
            </div>
            {% endif %}
        </div> -->
    </div>
    
    <!-- System Information -->
    <div class="admin-section">
        <div class="section-header">
            <h2><i class="fas fa-server"></i> System Information</h2>
        </div>
        <div class="system-info-grid">
            <div class="info-card">
                <h4><i class="fas fa-database"></i> Database Status</h4>
                <p><span style="color: #4CAF50;">‚úÖ</span> Connected to MongoDB Atlas</p>
                <p><span style="color: #2196F3;">üìä</span> Collections: Users, Uploads, Queries, Pests</p>
                <p><span style="color: #FF9800;">üíæ</span> Storage: {{ ((total_uploads * 0.5)|round(2)) }} MB used</p>
            </div>
            <div class="info-card">
                <h4><i class="fas fa-heartbeat"></i> System Health</h4>
                <p><span style="color: #4CAF50;">üü¢</span> All systems operational</p>
                <p><span style="color: #00BCD4;">‚ö°</span> Performance: Excellent</p>
                <p><span style="color: #9C27B0;">üîí</span> Security: Protected</p>
            </div>
            <div class="info-card">
                <h4><i class="fas fa-chart-bar"></i> Activity Summary</h4>
                <p><span style="color: #2196F3;">üë•</span> {{ total_users }} registered users</p>
                <p><span style="color: #4CAF50;">üì∏</span> {{ total_uploads }} image uploads</p>
                <p><span style="color: #FF9800;">üí¨</span> {{ total_queries }} user queries</p>
            </div>
        </div>
    </div>
</div>

<!-- Add Chart.js library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Initialize charts when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadDashboardCharts();
});

function loadDashboardCharts() {
    // Fetch chart data from API
    fetch('/admin/api/stats/overview')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Line chart for uploads and queries
                const lineCtx = document.getElementById('lineChart').getContext('2d');
                new Chart(lineCtx, {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: [
                            {
                                label: 'Uploads',
                                data: data.uploads,
                                borderColor: '#4CAF50',
                                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                tension: 0.4,
                                borderWidth: 2
                            },
                            {
                                label: 'Queries',
                                data: data.queries,
                                borderColor: '#2196F3',
                                backgroundColor: 'rgba(33, 150, 243, 0.1)',
                                tension: 0.4,
                                borderWidth: 2
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: 'white'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Last 7 Days Activity',
                                color: 'white',
                                font: {
                                    size: 16
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            }
                        }
                    }
                });
                
                // Pie chart for top pests
                const pieCtx = document.getElementById('pieChart').getContext('2d');
                new Chart(pieCtx, {
                    type: 'pie',
                    data: {
                        labels: data.top_pests.labels,
                        datasets: [{
                            data: data.top_pests.counts,
                            backgroundColor: [
                                '#FF6384', '#36A2EB', '#FFCE56', 
                                '#4BC0C0', '#9966FF'
                            ],
                            borderWidth: 1,
                            borderColor: 'rgba(255, 255, 255, 0.1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    color: 'white',
                                    padding: 20
                                }
                            },
                            title: {
                                display: true,
                                text: 'Top Detected Pests',
                                color: 'white',
                                font: {
                                    size: 16
                                }
                            }
                        }
                    }
                });
            } else {
                console.error('Failed to load chart data:', data.error);
                showNotification('Failed to load chart data', 'error');
            }
        })
        .catch(error => {
            console.error('Error loading charts:', error);
            showNotification('Error loading charts', 'error');
        });
}

// Function to view upload details
function viewUpload(uploadId) {
    // Redirect to result page
    window.location.href = `/view-detection/${uploadId}`;
}

// Function to delete upload
function deleteUpload(uploadId) {
    if (confirm('Are you sure you want to delete this upload?')) {
        fetch(`/delete_upload/${uploadId}`, {
            method: 'DELETE',
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Upload deleted successfully!', 'success');
                setTimeout(() => location.reload(), 1000);
            } else {
                showNotification(data.error || 'Error deleting upload', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Error deleting upload', 'error');
        });
    }
}

// Function to edit upload
function editUpload(uploadId) {
    showNotification('Edit feature coming soon!', 'info');
}

// Notification system
function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        border-radius: 10px;
        color: white;
        font-weight: 500;
        z-index: 10001;
        animation: slideIn 0.3s ease-out;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        backdrop-filter: blur(10px);
    `;
    
    if (type === 'success') {
        notification.style.background = 'linear-gradient(135deg, #4CAF50, #388E3C)';
        notification.style.borderLeft = '5px solid #2E7D32';
    } else if (type === 'error') {
        notification.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';
        notification.style.borderLeft = '5px solid #c62828';
    } else if (type === 'info') {
        notification.style.background = 'linear-gradient(135deg, #2196F3, #1976D2)';
        notification.style.borderLeft = '5px solid #0D47A1';
    }
    
    document.body.appendChild(notification);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in forwards';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Add CSS for animations
const notificationStyles = document.createElement('style');
notificationStyles.textContent = `
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
`;
document.head.appendChild(notificationStyles);

// Auto refresh stats every 30 seconds
setInterval(function() {
    fetch('/admin/api/stats/overview')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('Stats refreshed:', data);
                // You can update charts here if needed
            }
        })
        .catch(error => console.error('Error refreshing stats:', error));
}, 30000);

// Initialize tooltips
document.addEventListener('DOMContentLoaded', function() {
    // Add hover effects to all buttons
    document.querySelectorAll('button').forEach(button => {
        button.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
        });
        button.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
    
    // Add loading animation to cards on hover
    document.querySelectorAll('.admin-stat-card, .quick-action-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            const icon = this.querySelector('.stat-icon, .action-icon');
            if (icon) {
                icon.style.transform = 'rotate(5deg) scale(1.1)';
                icon.style.transition = 'transform 0.3s ease';
            }
        });
        card.addEventListener('mouseleave', function() {
            const icon = this.querySelector('.stat-icon, .action-icon');
            if (icon) {
                icon.style.transform = 'rotate(0) scale(1)';
            }
        });
    });
});
</script>
{% endblock %}