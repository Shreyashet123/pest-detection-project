{% extends "layout.html" %}

{% block body %}
<style>
    .edit-pest-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 30px;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 15px;
        color: white;
    }
    
    /* Reuse styles from add_pest.html, but change colors for edit */
    .edit-pest-container h1 {
        text-align: center;
        margin-bottom: 30px;
        color: #2196F3;
        font-size: 2.5em;
    }
    
    .btn-update {
        background: linear-gradient(135deg, #2196F3, #0d47a1);
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 10px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        transition: all 0.3s;
        margin-top: 20px;
    }
    
    .btn-update:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(33, 150, 243, 0.3);
    }
    
    .current-image {
        margin-top: 15px;
        max-width: 300px;
        border-radius: 10px;
        border: 2px solid #2196F3;
    }
    
    .form-check {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
    }
    
    .form-check input {
        width: 20px;
        height: 20px;
    }
    
    .form-check label {
        margin: 0;
        color: #FF9800;
    }
</style>

<div class="edit-pest-container">
    <a href="{{ url_for('admin_add_pest') }}" class="back-link">
        <i class="fas fa-arrow-left"></i> Back to Pest Library
    </a>
    
    <h1><i class="fas fa-edit"></i> Edit Pest: {{ pest.name }}</h1>
    
    <div class="note" style="background: rgba(33, 150, 243, 0.1); border-left-color: #2196F3; color: #2196F3;">
        <i class="fas fa-info-circle"></i>
        <strong>Note:</strong> Editing this pest will update the information for all users.
    </div>
    
    <form action="{{ url_for('admin_edit_pest', pest_id=pest.id) }}" method="POST" enctype="multipart/form-data">
        <!-- Basic Information Section -->
        <div class="form-section">
            <h3 style="color: #2196F3; margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> Basic Information
            </h3>
            
            <div class="form-group">
                <label for="name">Pest Name <span class="required">*</span></label>
                <input type="text" id="name" name="name" class="form-control" 
                       value="{{ pest.name }}" required>
            </div>
            
            <div class="form-group">
                <label for="scientific_name">Scientific Name</label>
                <input type="text" id="scientific_name" name="scientific_name" class="form-control"
                       value="{{ pest.scientific_name or '' }}">
            </div>
            
            <div class="form-group">
                <label for="description">Description <span class="required">*</span></label>
                <textarea id="description" name="description" class="form-control" required>{{ pest.description }}</textarea>
            </div>
        </div>
        
        <!-- Pest Details Section -->
        <div class="form-section">
            <h3 style="color: #FF9800; margin-bottom: 20px;">
                <i class="fas fa-bug"></i> Pest Details
            </h3>
            
            <div class="form-group">
                <label for="harmful_effects">Harmful Effects (one per line)</label>
                <textarea id="harmful_effects" name="harmful_effects" class="form-control">{{ pest.harmful_effects or '' }}</textarea>
            </div>
            
            <div class="form-group">
                <label for="organic_solutions">Organic Solutions (one per line)</label>
                <textarea id="organic_solutions" name="organic_solutions" class="form-control">{{ pest.organic_solutions or '' }}</textarea>
            </div>
            
            <div class="form-group">
                <label for="chemical_pesticides">Chemical Pesticides (one per line)</label>
                <textarea id="chemical_pesticides" name="chemical_pesticides" class="form-control">{{ pest.chemical_pesticides or '' }}</textarea>
            </div>
            
            <div class="form-group">
                <label for="prevention_methods">Prevention Methods (one per line)</label>
                <textarea id="prevention_methods" name="prevention_methods" class="form-control">{{ pest.prevention_methods or '' }}</textarea>
            </div>
        </div>
        
        <!-- Additional Information Section -->
        <div class="form-section">
            <h3 style="color: #0dcaf0; margin-bottom: 20px;">
                <i class="fas fa-sliders-h"></i> Additional Information
            </h3>
            
            <div class="form-group">
                <label>Severity Level <span class="required">*</span></label>
                <div class="severity-options">
                    {% for severity in ['low', 'medium', 'high', 'very_high'] %}
                    <div class="severity-option severity-{{ severity }}">
                        <input type="radio" id="severity_{{ severity }}" name="severity" 
                               value="{{ severity }}" {{ 'checked' if pest.severity == severity else '' }} required>
                        <label for="severity_{{ severity }}">{{ severity|replace('_', ' ')|title }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="form-group">
                <label>Active Status</label>
                <div class="form-check">
                    <input type="checkbox" id="is_active" name="is_active" 
                           {{ 'checked' if pest.is_active else '' }}>
                    <label for="is_active">This pest is active and visible to users</label>
                </div>
            </div>
            
            <div class="form-group">
                <label for="image">Pest Image</label>
                {% if pest.image_path %}
                <div>
                    <img src="{{ url_for('static', filename='uploads/' + pest.image_path) }}" 
                         alt="{{ pest.name }}" class="current-image">
                    <div style="margin-top: 10px;">
                        <label>
                            <input type="checkbox" name="remove_image" value="1">
                            Remove current image
                        </label>
                    </div>
                </div>
                {% endif %}
                <input type="file" id="image" name="image" class="form-control" accept="image/*">
                <div class="file-info">
                    <i class="fas fa-info-circle"></i> Upload a new image to replace the current one (optional)
                </div>
            </div>
        </div>
        
        <button type="submit" class="btn-update">
            <i class="fas fa-save"></i> Update Pest Information
        </button>
    </form>
</div>

<script>
    // Form validation for edit
    document.querySelector('form').addEventListener('submit', function(e) {
        const name = document.getElementById('name').value.trim();
        const description = document.getElementById('description').value.trim();
        
        if (!name) {
            alert('Pest name is required!');
            e.preventDefault();
            return;
        }
        
        if (!description) {
            alert('Description is required!');
            e.preventDefault();
            return;
        }
        
        if (!document.querySelector('input[name="severity"]:checked')) {
            alert('Please select a severity level!');
            e.preventDefault();
            return;
        }
        
        // Confirm before submitting
        const confirmMessage = `Are you sure you want to update "${name}"?\n\nThese changes will affect all users.`;
        if (!confirm(confirmMessage)) {
            e.preventDefault();
            return;
        }
        
        // Show loading state
        const submitBtn = document.querySelector('.btn-update');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
        submitBtn.disabled = true;
    });
</script>
{% endblock %}