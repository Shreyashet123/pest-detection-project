{% extends "layout.html" %}

{% block body %}
<div class="auth-container">
    <div class="auth-box">
        <h2><i class="fas fa-user-shield"></i> Welcome to Pest Detection</h2>
        <p class="auth-subtitle">Sign in or create your free account</p>
        
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        <i class="fas 
                            {% if category == 'success' %}fa-check-circle
                            {% elif category == 'danger' %}fa-exclamation-circle
                            {% elif category == 'warning' %}fa-exclamation-triangle
                            {% else %}fa-info-circle{% endif %}">
                        </i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <!-- Admin Login Note -->
        <div class="admin-note">
            <i class="fas fa-crown"></i>
            <strong>Admin:</strong> admin@gmail.com / admin
        </div>
        
        <!-- Unified Authentication Form -->
        <form method="POST" action="{{ url_for('process_auth') }}" class="auth-form">
            <div class="form-group">
                <label for="email">
                    <i class="fas fa-envelope"></i> Email Address
                </label>
                <input type="email" id="email" name="email" required 
                       placeholder="you@example.com" autocomplete="email">
            </div>
            
            <div class="form-group">
                <label for="password">
                    <i class="fas fa-lock"></i> Password
                </label>
                <input type="password" id="password" name="password" required 
                       placeholder="Enter your password" autocomplete="current-password">
            </div>
            
            <!-- Dual Action Buttons -->
            <div class="button-group">
                <button type="submit" name="action" value="signin" class="btn btn-login">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>
                
                <button type="submit" name="action" value="join" class="btn btn-register">
                    <i class="fas fa-user-plus"></i> Join Now
                </button>
            </div>
            
            <div class="form-footer">
                <a href="{{ url_for('home') }}" class="back-link">
                    <i class="fas fa-arrow-left"></i> Back to Home
                </a>
            </div>
        </form>
        
        <!-- Divider -->
        <div class="divider">
            <span>or continue with</span>
        </div>
        
        <!-- Google Login (Optional) -->
        {% if GOOGLE_CLIENT_ID %}
        <a href="{{ url_for('google_auth_start') }}" class="google-btn">
            <i class="fab fa-google"></i> Continue with Google
        </a>
        {% endif %}
        
        <!-- Features List -->
        <div class="features">
            <h4><i class="fas fa-star"></i> Why Join Us?</h4>
            <ul>
                <li><i class="fas fa-check-circle"></i> AI-powered pest detection</li>
                <li><i class="fas fa-check-circle"></i> Crop recommendation system</li>
                <li><i class="fas fa-check-circle"></i> Pest library access</li>
                <li><i class="fas fa-check-circle"></i> Multi-language support</li>
                <li><i class="fas fa-check-circle"></i> Free forever for farmers</li>
            </ul>
        </div>
    </div>
</div>

<style>
/* ===== AUTHENTICATION STYLES ===== */
.auth-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 80vh;
    padding: 40px 20px;
}

.auth-box {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    padding: 40px;
    width: 100%;
    max-width: 450px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(10px);
}

.auth-box h2 {
    color: #2c3e50;
    text-align: center;
    margin-bottom: 10px;
    font-size: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.auth-subtitle {
    text-align: center;
    color: #7f8c8d;
    margin-bottom: 30px;
    font-size: 16px;
}

/* Form Styles */
.auth-form {
    margin: 25px 0;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #34495e;
    margin-bottom: 8px;
    font-weight: 600;
    font-size: 14px;
}

.form-group input {
    width: 100%;
    padding: 14px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.3s;
    background: white;
}

.form-group input:focus {
    border-color: #4CAF50;
    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    outline: none;
}

/* Button Group */
.button-group {
    display: flex;
    gap: 15px;
    margin: 30px 0;
}

.btn {
    flex: 1;
    padding: 15px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.btn-login {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
}

.btn-register {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
}

.btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.btn:active {
    transform: translateY(-1px);
}

/* Form Footer */
.form-footer {
    text-align: center;
    margin-top: 20px;
}

.back-link {
    color: #7f8c8d;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 14px;
}

.back-link:hover {
    color: #4CAF50;
}

/* Divider */
.divider {
    display: flex;
    align-items: center;
    margin: 30px 0;
    color: #95a5a6;
    font-size: 14px;
}

.divider::before,
.divider::after {
    content: "";
    flex: 1;
    border-bottom: 1px solid #e0e0e0;
}

.divider span {
    padding: 0 15px;
}

/* Google Button */
.google-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    width: 100%;
    padding: 14px;
    background: white;
    color: #333;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    font-size: 16px;
    transition: all 0.3s;
    margin-bottom: 30px;
}

.google-btn:hover {
    background: #f8f9fa;
    border-color: #dadce0;
    transform: translateY(-2px);
}

/* Features */
.features {
    margin-top: 30px;
    padding-top: 25px;
    border-top: 1px solid #e0e0e0;
}

.features h4 {
    color: #2c3e50;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.features ul {
    list-style: none;
    padding: 0;
}

.features li {
    padding: 8px 0;
    color: #555;
    display: flex;
    align-items: center;
    gap: 10px;
}

.features li i {
    color: #4CAF50;
}

/* Admin Note */
.admin-note {
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 193, 7, 0.05));
    border: 1px solid rgba(255, 193, 7, 0.3);
    border-radius: 8px;
    padding: 12px 15px;
    margin: 20px 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    color: #d35400;
    font-size: 14px;
}

.admin-note i {
    color: #f39c12;
}

/* Alerts */
.alert {
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    border: 1px solid transparent;
}

.alert-success {
    background: rgba(76, 175, 80, 0.1);
    border-color: rgba(76, 175, 80, 0.2);
    color: #2e7d32;
}

.alert-danger {
    background: rgba(244, 67, 54, 0.1);
    border-color: rgba(244, 67, 54, 0.2);
    color: #c62828;
}

.alert-warning {
    background: rgba(255, 193, 7, 0.1);
    border-color: rgba(255, 193, 7, 0.2);
    color: #f57c00;
}

.alert-info {
    background: rgba(33, 150, 243, 0.1);
    border-color: rgba(33, 150, 243, 0.2);
    color: #1565c0;
}

/* Responsive */
@media (max-width: 768px) {
    .auth-box {
        padding: 30px 20px;
        margin: 20px;
    }
    
    .button-group {
        flex-direction: column;
    }
    
    .auth-box h2 {
        font-size: 24px;
    }
}

@media (max-width: 480px) {
    .auth-container {
        padding: 20px 10px;
    }
    
    .auth-box {
        padding: 25px 15px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-focus email field
    const emailField = document.getElementById('email');
    if (emailField) {
        emailField.focus();
    }
    
    // Show password toggle (optional enhancement)
    const passwordField = document.getElementById('password');
    const toggleBtn = document.createElement('button');
    toggleBtn.type = 'button';
    toggleBtn.innerHTML = '<i class="fas fa-eye"></i>';
    toggleBtn.style.cssText = `
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #7f8c8d;
        cursor: pointer;
    `;
    
    const passwordGroup = passwordField.parentElement;
    passwordGroup.style.position = 'relative';
    passwordGroup.appendChild(toggleBtn);
    
    toggleBtn.addEventListener('click', function() {
        const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordField.setAttribute('type', type);
        this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
    });
    
    // Auto-hide alerts after 5 seconds
    setTimeout(function() {
        document.querySelectorAll('.alert').forEach(function(alert) {
            alert.style.transition = 'opacity 0.5s ease';
            alert.style.opacity = '0';
            setTimeout(function() {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 500);
        });
    }, 5000);
});
</script>
{% endblock %}